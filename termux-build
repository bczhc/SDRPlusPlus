#!/bin/bash

set -e

SDR_KIT_DIR=/home/bczhc/bin/sdrpp-sdr-kit
NDK_DIR=/home/bczhc/bin/AndroidSdk/ndk/25.1.8937393

ln -sf "$SDR_KIT_DIR" ./sdr-kit

mkdir build 2>/dev/null || true
cd build

cmake .. -G Ninja \
-DANDROID_NDK="$NDK_DIR" \
-DCMAKE_TOOLCHAIN_FILE="$NDK_DIR"/build/cmake/android.toolchain.cmake \
-DANDROID_ABI=arm64-v8a \
-DANDROID_PLATFORM=android-29 \
-DOPT_BUILD_DISCORD_PRESENCE=OFF \
-DOPT_BACKEND_GLFW=OFF \
-DOPT_BACKEND_ANDROID=ON \
-DOPT_BUILD_AUDIO_SINK=OFF \
-DOPT_BUILD_AUDIO_SOURCE=OFF \
-DOPT_BUILD_AIRSPY_SOURCE=ON \
-DOPT_BUILD_AIRSPYHF_SOURCE=ON \
-DOPT_BUILD_BLADERF_SOURCE=OFF \
-DOPT_BUILD_FILE_SOURCE=OFF \
-DOPT_BUILD_HACKRF_SOURCE=OFF \
-DOPT_BUILD_HERMES_SOURCE=OFF \
-DOPT_BUILD_LIMESDR_SOURCE=OFF \
-DOPT_BUILD_NETWORK_SOURCE=OFF \
-DOPT_BUILD_PERSEUS_SOURCE=OFF \
-DOPT_BUILD_PLUTOSDR_SOURCE=OFF \
-DOPT_BUILD_RFSPACE_SOURCE=OFF \
-DOPT_BUILD_RTL_SDR_SOURCE=OFF \
-DOPT_BUILD_RTL_TCP_SOURCE=OFF \
-DOPT_BUILD_SDRPLAY_SOURCE=OFF \
-DOPT_BUILD_SDRPP_SERVER_SOURCE=OFF \
-DOPT_BUILD_SOAPY_SOURCE=OFF \
-DOPT_BUILD_SPECTRAN_SOURCE=OFF \
-DOPT_BUILD_SPECTRAN_HTTP_SOURCE=OFF \
-DOPT_BUILD_SPYSERVER_SOURCE=OFF \
-DOPT_BUILD_USRP_SOURCE=OFF

ninja

mkdir libs
cp -v ../sdr-kit/arm64-v8a/lib/* libs
fd --extension=so -HI -x cp -v {} libs
